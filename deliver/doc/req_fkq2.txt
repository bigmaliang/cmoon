芒果IM需求文档
============


需求背景

    芒果 MPS 产品当前实现了 好友邀请, 站内信, 新鲜事 在社区内的实时推送。

    为了让社区中的用户可以即时交流信息, 增加用户粘度.  需要逐步向社区产品中添加即时聊天的功能.
当前准备为社区易受关注的用户(编辑/明星用户/高等级用户)提供一个聊天模块(原访客群概念), 主要达到能让访客之间“认识”，“打招呼”，“互加好友” 的目的，所有浏览该用户空间及其资源的访客能够即时交流信息。

    同时, 时间允许的情况下, 考虑为社区添加 *兴趣群* 和 *随机速聊* 功能.


    芒果IM(MIM)作为社区的附加产品, 需求取舍和产品实现上以稳定, 轻便, 易用, 不干扰为准则.


术语定义

    聊天模块：
        为在访问易受关注的用户空间及其内容的访客的聚合，提供相对有限的聊天功能。当前支持前100个访客，人满后需要有人离开才能加入。

    访客:
        访问开通了聊天模块的空间的所有金鹰网用户。

    主人:
        被访问空间的所有者. 主人也可以是访客(访问自己或别人的空间), 主人访问自己空间时不受人数限制.

    兴趣群:
        类似qq群组, 豆瓣的小组之类. 
        由编辑或者用户自由创建(创建的个数和规模上可以有不同限制)， 自由管理的私有群。

    随机速聊:
        由后台依据某些规则找个在线的用户与发起人闲聊的功能，当前仅支持一对一随机速聊，速聊可以做进一步分类使其更人性化和更有针对性。



详细需求


访客群主管理:

    I, 等级达到一定级别的用户自动开启访客群功能, 编辑和管理后台用户可以手动调整其用户等级.


访客群:
 
    I, 每个群有对应的黑名单管理(群主加黑, 或者在线用户半数以上同意加黑).
    I, 访客群有开通状态标志, 用户可以选择接受群内消息或者关闭访客群功能.
    I, 显示访客群在线人数, 进入聊天的人数.
    I, 保存每个访客群的最后X条对话记录, 减少访客群对正常浏览刷新和跳转的影响.
    I, 鼠标停留访客群内用户图标上, 弹层提示该用户正在浏览该群的最近5个页面.
    I, 发水频率限制, 每秒最多X条.
   
    后台功能(仅网站管理用，可作聚合页面的内容提供)：
    I, 分时段统计访客最多的前X个群主.（需要支持排行榜）
    I, 分时段统计访客超过X个的群主.（需要支持排行）

    I, 分时段统计在线时间, 登录次数用户排行(考虑为其增加积分和经验值)
 
 
    Other：
     1.访客群的状态如何在页面上体现？
     2.需要增加用户是否在线的标识
    不在线的不会出现在这个群里。
     3.用户即时聊天需要设定关键词过滤
     4.增加设置单点速聊的功能（即访问者和被访问者只能建立一对一的聊天窗口，不支持他人加入。该申请由一方用户提出，另外一方用户接受后建立关系。）这里的功能见下面"访客群内用户一对一对话" 需求
     5.考虑加入聊天群的积分消费接口。
     6.考虑扩展功能，如对群里的某个用户送鲜花之类的。
     7.利用图标标识用户的性别。
     8.支持官方聊天群，以插件的形式体现。

访客群内用户一对一对话:

    I, 每个用户有对应的黑名单管理, 拒绝广告用户骚扰.
    I, 每个用户可以同时保持多个 1:1 会话.
    I, 提供加好友快捷方式.


关注群(兴趣/粉丝群):

    I, 类似 qq 等级创建qq群, 用户可以创建的群数目跟其等级挂钩, 群内成员先统一限制X人.
    I, 等级达到X级的用户自动会有一个可以被人关注的群, 自己是群主, 其他用户点其页面的 "即时关注",
       便提交了加入该群的申请.
    I, 等级达到X级的用户会有一个群管理页面, 可以方便修改自己的群组, 也可以作为其属性展现给普通用户看,         吸引用户加入.
    I, 一个用户可能会参加多个群, 所以普通用户也需要有关注群的管理页面. 发起聊天时最好能支持群名搜索.
    I, 与访客群一样, 关注群内也可以一对一发起对话.
    I, 群内聊天信息需要保留(可以只保留部分群的最近X天聊天记录以缓解压力).
    I, 关注群有以下几种加入方式:
        普通用户主动申请
        群成员邀请普通用户(通过站内信/通知的方式)
        与活动联动, 参与活动的用户自动加入活动群.  (活动群需先由编辑在社区上建立)

    后台功能(仅网站管理用，可作聚合页面的内容提供)：
    I, 分时段统计在线最多的前X个群.（需要支持排行榜）              
    I, 分时段统计在线超过X个的群.（需要支持排行）


随机速聊:    

    参看”蚂蚁网蒙面速聊“产品，该功能主要是为了更好的实现陌生交友。
    Focus：
    1.男女速配的规则
    2.小工具的支持（测测我和TA的星座缘分和姓名缘分）


