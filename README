目录结构
=======

moon/
|-- maketool    编译辅助工具
|-- Make.env    编译相关宏定义
|-- Makefile    编译文件
|-- mtools      常用管理脚本
|-- doc         文档目录(杂七杂八)
|-- res         设计资源(杂七杂八)
|-- lib         库文件目录
|
|-- event       支持插件的高并发处理缓冲层后台, 详情请参考该目录文档和代码
|-- deliver     web push 解决方案 (参考 deliver/README)
|
!-- pop         应用: www.bomdoo.com 播豆网
|-- regae       应用: www.regae.com 送菜网(建设中。。。)
|-- ksa         应用: www.kosherall.com.cn 内容(moon 支持同时多个项目的开发:)
|-- ksc         DEPRECATED
|-- rock        DEPRECATED
|
`-- grabber     获取邮件, msn, qq 好友方案



新建项目
======
I 在moon内部新建
-------------
1, git clone voov 分支
2, cp regae NEWPROJ
3, cd NEWPROJ; sed -i 's/voov/PROJNAME/g' `grep -rl voov .`
4, find -name '*voov*'; rename them
5, mkdir -p /var/log/moon/NEWPROJ/; chmod 777 /var/log/moon/NEWPROJ/

II 在moon外部引用
--------------
1, git clone reage的 voov 分支
2, same as up
3, same as up
4, same as up
5, same as up
6, 修改 NEWPROJ//Make.env 之 BASEDIR 路径，指向 moon 所在目录
7, cd NEWPROJ 修改一下文件和目录的连接路径，指向 moon 所在目录
	./fly/js/pub
	./fly/css/pub
	./xport/daemon
	./xport/plugin/mevent_plugin.h
	./xport/plugin/mevent_skeleton.c
	./xport/plugin/mevent_skeleton.h
	./xport/test/stats.c
	./xport/test/timer.h



依赖
===

整个程序依赖如下软件包，请自行安装(可参考 /mtools/prepare_lib.sh 脚本)：

开发库
-----
clearsilver-dev
libfcgi-dev
libjson0-dev
libmemcached-dev
libqdbm-dev (仅 cdata 依赖)
libnmdb     (仅 cdata 依赖. Debian 没有此包, --- 仅需安装 nmdb/libnmdb
             需要手动安装: http://blitiri.com.ar/p/nmdb/files/0.22/nmdb-0.22.tar.gz)

数据库(可选, Make.env 中可配置)
--------------------------
libmysqlclient-dev
libpq-dev
libsqlite3-dev

依赖路径写在 Make.env 中, 如果装好上面软件后还出现编译错误, 请自行修改 Make.env 之 DEPEND LIBRARY 部分.



运营安装
======
0, debian 5 32bit

1, apt-get dist-upgrade
   apt-get install locales, dpkg-reconfigure locales

2, modify apt source
   deb http://ftp.us.debian.org/debian squeeze main
   deb http://security.debian.org/ squeeze/updates main
   apt update

3, adduser moon
   chown moon:moon /usr/local/
   mkdir -p /data/logs/ && chown moon:moon /data/logs/
   mkdir -p /var/log/moon/ && chown moon:moon /var/log/moon/

4, apt-get install git git-core lighttpd postgresql
   install librarys need by moon according mtools/prepare_lib.sh
   scp /usr/include/ClearSilver/ClearSilver.h  /usr/lib/libneo_utl.a
   modify lighttpd and pg config according xxx/doc/system.txt
   (lightty enable fastcgi, disable cgi)

5, login as moon:
   cd /usr/local/ &&
   git clone git://github.com/bigml/cmoon.git && mv cmoon moon &&
   cd /usr/local/moon/lib/js/
   && git clone git://github.com/jquerytools/jquerytools.git
   && svn checkout http://flot.googlecode.com/svn/trunk/ flot
   && git clone git://github.com/malsup/cycle.git
   && git clone git://github.com/markitup/1.x.git markitup
   
   git clone git://github.com/bigml/APE_JSF.git &&
   git clone git://github.com/bigml/APE_Server.git
   vim pop/fly/js/ape/Makefile change DIR_JSF
   [vim pop/pub/lcfg.h PATH_SITE]

6, modify moon/Make.env(no space left in config line)
   cd lib ; make && cd event; make

7, [/usr/local/bin/]memcached -d -m 16 -p 11211 -u nobody -l 127.0.0.1

8, modify event/conf/server.hdf  pop/config.hdf APE_Server/bin/ape.conf loglevel from 7 to 3


注:
==

1. use 4 spaces as TAB, set (setq-default indent-tabs-mode nil) in ~/.emacs
2. RESERVED key in request url
    /json/xxx: output json
    _op: add, mod, del for ...
    _ntt: total number
    _nst: start number
    _npg: page number (_nst will overwrite _npg)
    _npp: number perpage
    

